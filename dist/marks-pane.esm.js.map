{"version":3,"file":"marks-pane.esm.js","sources":["../src/src/svg.ts","../src/src/events.ts","../src/src/marks.ts"],"sourcesContent":["export function createElement(name: string): SVGElement {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nexport default {\n    createElement: createElement\n};\n","export default {\n    proxyMouse: proxyMouse\n};\n\n/**\n * Start proxying all mouse events that occur on the target node to each node in\n * a set of tracked nodes.\n *\n * The items in tracked do not strictly have to be DOM Nodes, but they do have\n * to have dispatchEvent, getBoundingClientRect, and getClientRects methods.\n *\n * @param target The node on which to listen for mouse events.\n * @param tracked A (possibly mutable) array of nodes to which to proxy\n *                         events.\n */\nexport interface MarkLike {\n  dispatchEvent: (e: Event) => void;\n  getBoundingClientRect: () => DOMRect;\n  getClientRects: () => DOMRectList | DOMRect[];\n}\n\nexport function proxyMouse(target: Element, tracked: MarkLike[]) {\n  let eventTarget: Node | Document = target;\n\n  if (target.nodeName === \"iframe\" || target.nodeName === \"IFRAME\") {\n    try {\n      eventTarget = (target as HTMLIFrameElement).contentDocument || target;\n    } catch {\n      eventTarget = target;\n    }\n  }\n\n  function dispatch(e: MouseEvent | TouchEvent) {\n    // We walk through the set of tracked elements in reverse order so that\n    // events are sent to those most recently added first.\n    //\n    // This is the least surprising behaviour as it simulates the way the\n    // browser would work if items added later were drawn \"on top of\"\n    // earlier ones.\n    for (let i = tracked.length - 1; i >= 0; i--) {\n      const t = tracked[i];\n      let x: number, y: number;\n\n      if (\"touches\" in e && (e as TouchEvent).touches.length) {\n        x = (e as TouchEvent).touches[0].clientX;\n        y = (e as TouchEvent).touches[0].clientY;\n      } else {\n        x = (e as MouseEvent).clientX;\n        y = (e as MouseEvent).clientY;\n      }\n\n      if (!contains(t, target, x, y)) continue;\n      t.dispatchEvent(clone(e));\n      break;\n    }\n  }\n\n  for (const ev of [\"mouseup\", \"mousedown\", \"click\"]) {\n    eventTarget.addEventListener(ev, (e) => dispatch(e as MouseEvent), false);\n  }\n\n  eventTarget.addEventListener(\n    \"touchstart\",\n    (e) => dispatch(e as TouchEvent),\n    false\n  );\n}\n\n\n/**\n * Clone a mouse event object.\n */\nexport function clone(e: MouseEvent | TouchEvent): MouseEvent | TouchEvent {\n  if (\"touches\" in e) {\n    // TouchEvent: cloning is not supported, just return the original event\n    return e;\n  }\n\n  const opts = Object.assign({}, e, { bubbles: false });\n  return new MouseEvent(e.type, opts);\n}\n\n/**\n * Check if the item contains the point denoted by the passed coordinates\n */\nfunction contains(\n  item: MarkLike,\n  target: Element,\n  x: number,\n  y: number\n): boolean {\n  const offset = target.getBoundingClientRect();\n\n  function rectContains(r: DOMRect, x: number, y: number): boolean {\n    const top = r.top - offset.top;\n    const left = r.left - offset.left;\n    const bottom = top + r.height;\n    const right = left + r.width;\n    return top <= y && left <= x && bottom > y && right > x;\n  }\n\n  // Check overall bounding box first\n  const rect = item.getBoundingClientRect();\n  if (!rectContains(rect, x, y)) {\n    return false;\n  }\n\n  // Then continue to check each child rect\n  const rects = item.getClientRects();\n  for (let i = 0, len = rects.length; i < len; i++) {\n    if (rectContains(rects[i], x, y)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","import svg from './svg';\nimport events from './events';\n\nexport class Pane {\n  private target: Element;\n  private element: SVGElement;\n  private marks: Mark[];\n  private container: HTMLElement;\n\n  constructor(target: Element, container: HTMLElement = document.body) {\n    this.target = target;\n    this.element = svg.createElement(\"svg\");\n    this.marks = [];\n\n    // Match the coordinates of the target element\n    this.element.style.position = \"absolute\";\n    this.element.setAttribute(\"pointer-events\", \"none\");\n\n    // Set up mouse event proxying between the target element and the marks\n    events.proxyMouse(this.target, this.marks);\n\n    this.container = container;\n    this.container.appendChild(this.element);\n\n    this.render();\n  }\n\n  public addMark(mark: Mark) {\n    const g = svg.createElement(\"g\");\n    this.element.appendChild(g);\n    mark.bind(g, this.container);\n\n    this.marks.push(mark);\n\n    mark.render();\n    return mark;\n  }\n\n  public removeMark(mark: Mark) {\n    const idx = this.marks.indexOf(mark);\n\n    if (idx === -1) {\n      return;\n    }\n    \n    const el = mark.unbind();\n    \n    if (el) {\n      this.element.removeChild(el);\n    }\n\n    this.marks.splice(idx, 1);\n  }\n\n  public render() {\n    setCoords(this.element, coords(this.target, this.container));\n    for (let m of this.marks) {\n      m.render();\n    }\n  }\n}\n\n\nexport class Mark {\n  protected element: Element | null;\n  protected container: HTMLElement | null = null;\n  protected range: Range | null = null;\n\n  constructor() {\n    this.element = null;\n  }\n\n  bind(element: Element, container: HTMLElement) {\n    this.element = element;\n    this.container = container;\n  }\n\n  unbind() {\n    const el = this.element;\n    this.element = null;\n    return el;\n  }\n\n  render() {}\n\n  dispatchEvent(e: Event) {\n    if (!this.element) return;\n    this.element.dispatchEvent(e);\n  }\n\n  getBoundingClientRect() {\n    // Always return a DOMRect, fallback to a default zero rect if element is missing\n    if (this.element) {\n      return this.element.getBoundingClientRect();\n    }\n    // Fallback: return a DOMRect with all zeros\n    return new DOMRect(0, 0, 0, 0);\n  }\n\n  getClientRects() {\n    const rects: DOMRect[] = [];\n    let el = this.element?.firstChild;\n    while (el) {\n      if (el instanceof Element) {\n        rects.push(el.getBoundingClientRect());\n      }\n      el = el.nextSibling;\n    }\n    return rects;\n  }\n\n  filteredRanges(): DOMRect[] {\n    if (!this.range) {\n      return [];\n    }\n\n    // De-duplicate the boxes\n    const rects = Array.from(this.range.getClientRects());\n    const stringRects = rects.map((r) => JSON.stringify(r));\n    const setRects = new Set(stringRects);\n    return Array.from(setRects).map((sr) => JSON.parse(sr));\n  }\n}\n\nexport class Highlight extends Mark {\n  private className: string;\n  private data: Record<string, string>;\n  private attributes: Record<string, string>;\n\n  constructor(\n    range: Range | null,\n    className: string,\n    data: Record<string, string> = {},\n    attributes: Record<string, string> = {}\n  ) {\n    super();\n    this.range = range;\n    this.className = className;\n    this.data = data;\n    this.attributes = attributes;\n  }\n\n  bind(element: Element, container: HTMLElement) {\n    super.bind(element, container);\n\n    for (let attr in this.data) {\n      if (Object.prototype.hasOwnProperty.call(this.data, attr)) {\n        if (this.element instanceof HTMLElement) {\n          this.element.dataset[attr] = this.data[attr];\n        }\n      }\n    }\n\n    for (let attr in this.attributes) {\n      if (Object.prototype.hasOwnProperty.call(this.attributes, attr)) {\n        if (\n          this.element instanceof HTMLElement ||\n          this.element instanceof SVGElement\n        ) {\n          this.element.setAttribute(attr, this.attributes[attr]);\n        }\n      }\n    }\n\n    if (this.className) {\n      if (\n        this.element instanceof HTMLElement ||\n        this.element instanceof SVGElement\n      ) {\n        this.element.classList.add(this.className);\n      }\n    }\n  }\n\n  render() {\n    if (!this.element || !this.container) return;\n\n    while (this.element.firstChild) {\n      this.element.removeChild(this.element.firstChild);\n    }\n\n    const docFrag = this.element.ownerDocument.createDocumentFragment();\n    const filtered = this.filteredRanges();\n    const offset = this.element.getBoundingClientRect();\n    const container = this.container.getBoundingClientRect();\n\n    for (let i = 0, len = filtered.length; i < len; i++) {\n      const r = filtered[i];\n      const el = svg.createElement(\"rect\");\n      el.setAttribute(\"x\", String(r.left - offset.left + container.left));\n      el.setAttribute(\"y\", String(r.top - offset.top + container.top));\n      el.setAttribute(\"height\", String(r.height));\n      el.setAttribute(\"width\", String(r.width));\n      docFrag.appendChild(el);\n    }\n\n    this.element.appendChild(docFrag);\n  }\n}\n\nexport class Underline extends Highlight {\n  constructor(\n    range: Range | null,\n    className: string,\n    data: Record<string, string> = {},\n    attributes: Record<string, string> = {}\n  ) {\n    super(range, className, data, attributes);\n  }\n\n  render() {\n    if (!this.element || !this.container) return;\n    while (this.element.firstChild) {\n      this.element.removeChild(this.element.firstChild);\n    }\n\n    const docFrag = this.element.ownerDocument.createDocumentFragment();\n    const filtered = this.filteredRanges();\n    const offset = this.element.getBoundingClientRect();\n    const container = this.container.getBoundingClientRect();\n\n    for (let i = 0, len = filtered.length; i < len; i++) {\n      const r = filtered[i];\n\n      const rect = svg.createElement(\"rect\");\n      rect.setAttribute(\"x\", String(r.left - offset.left + container.left));\n      rect.setAttribute(\"y\", String(r.top - offset.top + container.top));\n      rect.setAttribute(\"height\", String(r.height));\n      rect.setAttribute(\"width\", String(r.width));\n      rect.setAttribute(\"fill\", \"none\");\n\n      const line = svg.createElement(\"line\");\n      line.setAttribute(\"x1\", String(r.left - offset.left + container.left));\n      line.setAttribute(\n        \"x2\",\n        String(r.left - offset.left + container.left + r.width)\n      );\n      line.setAttribute(\n        \"y1\",\n        String(r.top - offset.top + container.top + r.height - 1)\n      );\n      line.setAttribute(\n        \"y2\",\n        String(r.top - offset.top + container.top + r.height - 1)\n      );\n\n      line.setAttribute(\"stroke-width\", \"1\");\n      line.setAttribute(\"stroke\", \"black\"); //TODO: match text color?\n      line.setAttribute(\"stroke-linecap\", \"square\");\n\n      docFrag.appendChild(rect);\n      docFrag.appendChild(line);\n    }\n\n    this.element.appendChild(docFrag);\n  }\n}\n\n\nfunction coords(el: Element, container: HTMLElement): { top: number; left: number; height: number; width: number } {\n    const offset = container.getBoundingClientRect();\n    const rect = el.getBoundingClientRect();\n\n    return {\n        top: rect.top - offset.top,\n        left: rect.left - offset.left,\n        height: el.scrollHeight,\n        width: el.scrollWidth\n    };\n}\n\n\nfunction setCoords(\n  el: SVGElement,\n  coords: { top: number; left: number; height: number; width: number }\n) {\n  el.style.setProperty(\"top\", `${coords.top}px`, \"important\");\n  el.style.setProperty(\"left\", `${coords.left}px`, \"important\");\n  el.style.setProperty(\"height\", `${coords.height}px`, \"important\");\n  el.style.setProperty(\"width\", `${coords.width}px`, \"important\");\n}\n\n"],"names":[],"mappings":"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"}