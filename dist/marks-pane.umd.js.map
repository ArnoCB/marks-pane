{"version":3,"file":"marks-pane.umd.js","sources":["../src/src/svg.ts","../src/src/events.ts","../src/src/marks.ts"],"sourcesContent":["export function createElement(name: string): SVGElement {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nexport default {\n    createElement: createElement\n};\n","export default {\n    proxyMouse: proxyMouse\n};\n\n/**\n * Start proxying all mouse events that occur on the target node to each node in\n * a set of tracked nodes.\n *\n * The items in tracked do not strictly have to be DOM Nodes, but they do have\n * to have dispatchEvent, getBoundingClientRect, and getClientRects methods.\n *\n * @param target The node on which to listen for mouse events.\n * @param tracked A (possibly mutable) array of nodes to which to proxy\n *                         events.\n */\nexport interface MarkLike {\n  dispatchEvent: (e: Event) => void;\n  getBoundingClientRect: () => DOMRect;\n  getClientRects: () => DOMRectList | DOMRect[];\n}\n\nexport function proxyMouse(target: Element, tracked: MarkLike[]) {\n  let eventTarget: Node | Document = target;\n\n  if (target.nodeName === 'iframe' || target.nodeName === 'IFRAME') {\n    try {\n      eventTarget = (target as HTMLIFrameElement).contentDocument || target;\n    } catch {\n      eventTarget = target;\n    }\n  }\n\n  function dispatch(e: MouseEvent | TouchEvent) {\n    // We walk through the set of tracked elements in reverse order so that\n    // events are sent to those most recently added first.\n    //\n    // This is the least surprising behaviour as it simulates the way the\n    // browser would work if items added later were drawn \"on top of\"\n    // earlier ones.\n    for (let i = tracked.length - 1; i >= 0; i--) {\n      const t = tracked[i];\n      let x: number, y: number;\n\n      if ('touches' in e && (e as TouchEvent).touches.length) {\n        x = (e as TouchEvent).touches[0].clientX;\n        y = (e as TouchEvent).touches[0].clientY;\n      } else {\n        x = (e as MouseEvent).clientX;\n        y = (e as MouseEvent).clientY;\n      }\n\n      if (!contains(t, target, x, y)) continue;\n      t.dispatchEvent(clone(e));\n      break;\n    }\n  }\n\n  for (const ev of ['mouseup', 'mousedown', 'click']) {\n    eventTarget.addEventListener(ev, (e) => dispatch(e as MouseEvent), false);\n  }\n\n  eventTarget.addEventListener(\n    'touchstart',\n    (e) => dispatch(e as TouchEvent),\n    false\n  );\n}\n\n\n/**\n * Clone a mouse event object.\n */\nexport function clone(e: MouseEvent | TouchEvent): MouseEvent | TouchEvent {\n  if ('touches' in e) {\n    // TouchEvent: cloning is not supported, just return the original event\n    return e;\n  }\n\n  const opts = Object.assign({}, e, { bubbles: false });\n  return new MouseEvent(e.type, opts);\n}\n\n/**\n * Check if the item contains the point denoted by the passed coordinates\n */\nfunction contains(\n  item: MarkLike,\n  target: Element,\n  x: number,\n  y: number\n): boolean {\n  const offset = target.getBoundingClientRect();\n\n  function rectContains(r: DOMRect, x: number, y: number): boolean {\n    const top = r.top - offset.top;\n    const left = r.left - offset.left;\n    const bottom = top + r.height;\n    const right = left + r.width;\n    return top <= y && left <= x && bottom > y && right > x;\n  }\n\n  // Check overall bounding box first\n  const rect = item.getBoundingClientRect();\n  if (!rectContains(rect, x, y)) {\n    return false;\n  }\n\n  // Then continue to check each child rect\n  const rects = item.getClientRects();\n  for (let i = 0, len = rects.length; i < len; i++) {\n    if (rectContains(rects[i], x, y)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","import svg from './svg';\nimport events from './events';\n\nexport class Pane {\n  private target: Element;\n  private element: SVGElement;\n  private marks: Mark[];\n  private container: HTMLElement;\n\n  constructor(target: Element, container: HTMLElement = document.body) {\n    this.target = target;\n    this.element = svg.createElement('svg');\n    this.marks = [];\n\n    // Match the coordinates of the target element\n    this.element.style.position = 'absolute';\n    this.element.setAttribute('pointer-events', 'none');\n\n    // Set up mouse event proxying between the target element and the marks\n    events.proxyMouse(this.target, this.marks);\n\n    this.container = container;\n    this.container.appendChild(this.element);\n\n    this.render();\n  }\n\n  public addMark(mark: Mark) {\n    const g = svg.createElement('g');\n    this.element.appendChild(g);\n    mark.bind(g, this.container);\n\n    this.marks.push(mark);\n\n    mark.render();\n    return mark;\n  }\n\n  public removeMark(mark: Mark) {\n    const idx = this.marks.indexOf(mark);\n\n    if (idx === -1) {\n      return;\n    }\n    \n    const el = mark.unbind();\n    \n    if (el) {\n      this.element.removeChild(el);\n    }\n\n    this.marks.splice(idx, 1);\n  }\n\n  public render() {\n    setCoords(this.element, coords(this.target, this.container));\n    for (let m of this.marks) {\n      m.render();\n    }\n  }\n}\n\n\nexport class Mark {\n  protected element: Element | null;\n  protected container: HTMLElement | null = null;\n  protected range: Range | null = null;\n\n  constructor() {\n    this.element = null;\n  }\n\n  bind(element: Element, container: HTMLElement) {\n    this.element = element;\n    this.container = container;\n  }\n\n  unbind() {\n    const el = this.element;\n    this.element = null;\n    return el;\n  }\n\n  render() {}\n\n  dispatchEvent(e: Event) {\n    if (!this.element) return;\n    this.element.dispatchEvent(e);\n  }\n\n  getBoundingClientRect() {\n    // Always return a DOMRect, fallback to a default zero rect if element is missing\n    if (this.element) {\n      return this.element.getBoundingClientRect();\n    }\n    // Fallback: return a DOMRect with all zeros\n    return new DOMRect(0, 0, 0, 0);\n  }\n\n  getClientRects() {\n    const rects: DOMRect[] = [];\n    let el = this.element?.firstChild;\n    while (el) {\n      if (el instanceof Element) {\n        rects.push(el.getBoundingClientRect());\n      }\n      el = el.nextSibling;\n    }\n    return rects;\n  }\n\n  filteredRanges(): DOMRect[] {\n    if (!this.range) {\n      return [];\n    }\n\n    // De-duplicate the boxes\n    const rects = Array.from(this.range.getClientRects());\n    const stringRects = rects.map((r) => JSON.stringify(r));\n    const setRects = new Set(stringRects);\n    return Array.from(setRects).map((sr) => JSON.parse(sr));\n  }\n}\n\nexport class Highlight extends Mark {\n  private className: string;\n  private data: Record<string, string>;\n  private attributes: Record<string, string>;\n\n  constructor(\n    range: Range | null,\n    className: string,\n    data: Record<string, string> = {},\n    attributes: Record<string, string> = {}\n  ) {\n    super();\n    this.range = range;\n    this.className = className;\n    this.data = data;\n    this.attributes = attributes;\n  }\n\n  bind(element: Element, container: HTMLElement) {\n    super.bind(element, container);\n\n    for (let attr in this.data) {\n      if (Object.prototype.hasOwnProperty.call(this.data, attr)) {\n        if (this.element instanceof HTMLElement) {\n          this.element.dataset[attr] = this.data[attr];\n        }\n      }\n    }\n\n    for (let attr in this.attributes) {\n      if (Object.prototype.hasOwnProperty.call(this.attributes, attr)) {\n        if (\n          this.element instanceof HTMLElement ||\n          this.element instanceof SVGElement\n        ) {\n          this.element.setAttribute(attr, this.attributes[attr]);\n        }\n      }\n    }\n\n    if (this.className) {\n      if (\n        this.element instanceof HTMLElement ||\n        this.element instanceof SVGElement\n      ) {\n        this.element.classList.add(this.className);\n      }\n    }\n  }\n\n  render() {\n    if (!this.element || !this.container) return;\n\n    while (this.element.firstChild) {\n      this.element.removeChild(this.element.firstChild);\n    }\n\n    const docFrag = this.element.ownerDocument.createDocumentFragment();\n    const filtered = this.filteredRanges();\n    const offset = this.element.getBoundingClientRect();\n    const container = this.container.getBoundingClientRect();\n\n    for (let i = 0, len = filtered.length; i < len; i++) {\n      const r = filtered[i];\n      const el = svg.createElement('rect');\n      el.setAttribute('x', String(r.left - offset.left + container.left));\n      el.setAttribute('y', String(r.top - offset.top + container.top));\n      el.setAttribute('height', String(r.height));\n      el.setAttribute('width', String(r.width));\n      docFrag.appendChild(el);\n    }\n\n    this.element.appendChild(docFrag);\n  }\n}\n\nexport class Underline extends Highlight {\n  constructor(\n    range: Range | null,\n    className: string,\n    data: Record<string, string> = {},\n    attributes: Record<string, string> = {}\n  ) {\n    super(range, className, data, attributes);\n  }\n\n  render() {\n    if (!this.element || !this.container) return;\n    while (this.element.firstChild) {\n      this.element.removeChild(this.element.firstChild);\n    }\n\n    const docFrag = this.element.ownerDocument.createDocumentFragment();\n    const filtered = this.filteredRanges();\n    const offset = this.element.getBoundingClientRect();\n    const container = this.container.getBoundingClientRect();\n\n    for (let i = 0, len = filtered.length; i < len; i++) {\n      const r = filtered[i];\n\n      const rect = svg.createElement('rect');\n      rect.setAttribute('x', String(r.left - offset.left + container.left));\n      rect.setAttribute('y', String(r.top - offset.top + container.top));\n      rect.setAttribute('height', String(r.height));\n      rect.setAttribute('width', String(r.width));\n      rect.setAttribute('fill', 'none');\n\n      const line = svg.createElement('line');\n      line.setAttribute('x1', String(r.left - offset.left + container.left));\n      line.setAttribute(\n        'x2',\n        String(r.left - offset.left + container.left + r.width)\n      );\n      line.setAttribute(\n        'y1',\n        String(r.top - offset.top + container.top + r.height - 1)\n      );\n      line.setAttribute(\n        'y2',\n        String(r.top - offset.top + container.top + r.height - 1)\n      );\n\n      line.setAttribute('stroke-width', '1');\n      line.setAttribute('stroke', 'black');\n      line.setAttribute('stroke-linecap', 'square');\n\n      docFrag.appendChild(rect);\n      docFrag.appendChild(line);\n    }\n\n    this.element.appendChild(docFrag);\n  }\n}\n\nfunction coords(el: Element, container: HTMLElement): { top: number; left: number; height: number; width: number } {\n    const offset = container.getBoundingClientRect();\n    const rect = el.getBoundingClientRect();\n\n    return {\n        top: rect.top - offset.top,\n        left: rect.left - offset.left,\n        height: el.scrollHeight,\n        width: el.scrollWidth\n    };\n}\n\nfunction setCoords(\n  el: SVGElement,\n  coords: { top: number; left: number; height: number; width: number }\n) {\n  el.style.setProperty('top', `${coords.top}px`, 'important');\n  el.style.setProperty('left', `${coords.left}px`, 'important');\n  el.style.setProperty('height', `${coords.height}px`, 'important');\n  el.style.setProperty('width', `${coords.width}px`, 'important');\n}\n"],"names":[],"mappings":"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"}